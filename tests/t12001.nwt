# test file read with using block

import list
import io

file_name := "../tests/files/abc.inout"

data := @byte_list with { data = 0x63 }
data = data with { data = 0x62, next = data }
data = data with { data = 0x61, next = data }

write_result := using open_byte_stream(file_name, @stream_mode with { write = true, binary = true, trunc = true }) as stream -> error_list? {
	for datum in data {
		r := write(stream, datum)
		match (r)
			value {
				return value # we have an error
			} | nil {}
	}

	return nil
}

read_result := using open_byte_stream(file_name, @stream_mode with { read = true, binary = true }) as stream -> error_list? {
	for value in read(stream) {
		match(value)
			data {
				print(data)
			} | errors {
				return errors
			}
	}

	return nil
}
